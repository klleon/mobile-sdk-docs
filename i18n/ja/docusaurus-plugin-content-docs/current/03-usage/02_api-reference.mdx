---
id: api-reference
sidebar_position: 3
title: api-reference
sidebar_label: APIリファレンス
---
# APIリファレンス

## コアコンポーネント

### KlleonOndeviceSdk

すべての機能を提供するメインSDKクラスです。

```kotlin
val klleonOndeviceSdk = KlleonOndeviceSdk()
```

### KlleonSdkView

SDKコンテンツをレンダリングするためのカスタムAndroid Viewです。

```kotlin
@Composable
fun SdkViewComponent() {
    var workerView by remember { mutableStateOf<KlleonSdkView?>(null) }
    
    AndroidView(
        factory = { context ->
            KlleonSdkView(context).also { view ->
                workerView = view
            }
        },
        modifier = Modifier.fillMaxSize()
    )
}
```

## SDKメソッド

### play()

顔認識処理とともにビデオ再生を開始します。

```kotlin
klleonOndeviceSdk.play(
    activity: ComponentActivity,
    view: KlleonSdkView,
    videoPath: String,
    facialPath: String,
    sdkKey: String
)
```

**パラメータ:**
- `activity`: ComponentActivity - 現在のアクティビティコンテキスト
- `view`: KlleonSdkView - レンダリング用のビューインスタンス
- `videoPath`: String - ビデオファイルの絶対パス (.mp4)
- `facialPath`: String - 顔処理ファイルの絶対パス (.npz)
- `sdkKey`: String - 固有SDK識別子

**例:**
```kotlin
workerView?.let { view ->
    klleonOndeviceSdk.play(
        context as ComponentActivity,
        view,
        vpPath,
        fpPath,
        "SDK KEY"
    )
}
```

### finish()

SDKを停止し、リソースをクリーンアップします。

```kotlin
klleonOndeviceSdk.finish()
```

**使用法:**
```kotlin
Button(
    onClick = { klleonOndeviceSdk.finish() }
) {
    Text("Stop")
}
```

### sendMessage()

SDKのメッセージングシステムを通じてメッセージを送信します。

```kotlin
klleonOndeviceSdk.sendMessage(message: String)
```

**パラメータ:**
- `message`: String - 送信するメッセージ内容

**例:**
```kotlin
try {
    klleonOndeviceSdk.sendMessage("Hello from app")
} catch (e: Exception) {
    Log.e("SDK", "Error sending message", e)
}
```

### sendMessageEcho()

SDKを通じてエコーメッセージを送信します。

```kotlin
klleonOndeviceSdk.sendMessageEcho(message: String)
```

**パラメータ:**
- `message`: String - エコーするメッセージ内容

**例:**
```kotlin
try {
    klleonOndeviceSdk.sendMessageEcho("Echo test")
} catch (e: Exception) {
    Log.e("SDK", "Error sending echo message", e)
}
```

## 状態管理

### sdkState

SDK状態更新をJSON文字列として発行するFlowです。

```kotlin
klleonOndeviceSdk.sdkState: Flow<String>
```

**使用法:**
```kotlin
klleonOndeviceSdk.sdkState.collect { state ->
    val messageToAdd = try {
        val json = JSONObject(state)
        json.getString("message")
    } catch (t: Throwable) {
        state.toString()
    }
    
    // 状態更新の処理
    updateUI(messageToAdd)
}
```

**状態形式:**
状態は一般的に以下を含むJSON文字列です：
```json
{
  "message":"","chat_type":"ACTIVATE_VOICE","time":"2025-09-03T05:42:08.394975295","id":"99dd3ab3-53c4-4418-bee4-b1fbaea272aa"
}
```

## エラー処理

すべてのSDKメソッドはtry-catchブロックでラップする必要があります：

```kotlin
try {
    klleonOndeviceSdk.sendMessage(message)
} catch (e: Exception) {
    Log.e("KlleonSDK", "操作失敗", e)
    // 適切なエラー処理
}
```

## ライフサイクル管理

```kotlin
class MainActivity : ComponentActivity() {
    private val klleonOndeviceSdk = KlleonOndeviceSdk()
    
    override fun onDestroy() {
        super.onDestroy()
        klleonOndeviceSdk.finish() // リソースクリーンアップ
    }
}
```
