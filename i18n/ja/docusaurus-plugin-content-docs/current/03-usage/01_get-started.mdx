---
id: get-started
sidebar_position: 3
title: get-started
sidebar_label: 始め方
---

# 始め方

## 前提条件

Klleon Chat SDKを使用する前に、以下の準備が必要です：

1.  **Kleon Studioアカウント**: SDK機能を使用するには[Kleon Studio](https://www.studio.klleon.io/)アカウントが必要です。アカウントがない場合は、まず登録してください。
2.  **SDKキー発行**: ドメイン登録後、そのドメインで使用する固有の`sdk_key`が発行されます。このキーはSDK初期化に必要です。

## パーミッション

### AndroidManifest.xml

`AndroidManifest.xml`に必要なパーミッションを追加してください：

```xml
<uses-permission android:name="android.permission.RECORD_AUDIO" />
<uses-permission android:name="android.permission.INTERNET" />
<uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />
```

### コードでのパーミッション処理

```kotlin
class MainActivity : ComponentActivity() {
    private val requiredPermissions = arrayOf(
        Manifest.permission.RECORD_AUDIO
    )

    private val permissionLauncher = registerForActivityResult(
        ActivityResultContracts.RequestMultiplePermissions()
    ) { permissions ->
        handlePermissionResults(permissions)
    }

    private fun checkPermissions(): Boolean {
        return requiredPermissions.all { permission ->
            ContextCompat.checkSelfPermission(this, permission) == PackageManager.PERMISSION_GRANTED
        }
    }

    private fun requestPermissions() {
        val permissionsToRequest = requiredPermissions.filter { permission ->
            ContextCompat.checkSelfPermission(this, permission) != PackageManager.PERMISSION_GRANTED
        }.toTypedArray()

        if (permissionsToRequest.isNotEmpty()) {
            permissionLauncher.launch(permissionsToRequest)
        }
    }

    private fun handlePermissionResults(permissions: Map<String, Boolean>) {
        val deniedPermissions = permissions.filter { !it.value }.keys

        if (deniedPermissions.isEmpty()) {
            Log.d("MainActivity", "すべてのパーミッションが許可されました")
            initializeApp()
        } else {
            Log.w("MainActivity", "パーミッションが拒否されました: $deniedPermissions")
            // 拒否されたパーミッションの処理
        }
    }
}
```

## SDK初期化

### 基本設定

```kotlin
import io.klleon.ondevice.KlleonOndeviceSdk
import io.klleon.ondevice.render.KlleonSdkView

@RequiresApi(Build.VERSION_CODES.S)
class MainActivity : ComponentActivity() {
    private val klleonOndeviceSdk = KlleonOndeviceSdk()
    
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        
        if (checkPermissions()) {
            initializeApp()
        } else {
            requestPermissions()
        }
    }

    private fun initializeApp() {
        setContent {
            OndeviceSampleTheme {
                Surface(
                    modifier = Modifier.fillMaxSize(),
                    color = MaterialTheme.colorScheme.background
                ) {
                    WorkerScreen(klleonOndeviceSdk = klleonOndeviceSdk)
                }
            }
        }

        copyAssetToCache("loop_sample.mp4")
        copyAssetToCache("loop_sample.npz")
    }

    private fun copyAssetToCache(fileName: String) {
        try {
            val assetManager = assets
            val inputStream = assetManager.open(fileName)
            val cacheFile = File(cacheDir, fileName)

            if (!cacheFile.exists()) {
                val outputStream = FileOutputStream(cacheFile)
                inputStream.copyTo(outputStream)
                outputStream.close()
                Log.d("MainActivity", "$fileNameをキャッシュにコピーしました: ${cacheFile.absolutePath}")
            }
            inputStream.close()
        } catch (e: IOException) {
            Log.e("MainActivity", "アセット$fileNameコピー中にエラーが発生しました", e)
        }
    }
}
```

## 次のステップ

設定完了後：

1. 使用可能なメソッドは[APIリファレンス](api-reference)を確認してください
2. 最適な統合のために[ガイド](../guides/guides)に従ってください
3. 実装パターンは[使用例](../examples/examples)を確認してください
