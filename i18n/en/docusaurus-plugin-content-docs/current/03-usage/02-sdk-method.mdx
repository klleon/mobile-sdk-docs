---
sidebar_position: 4
title: SDK 메서드
---

import { Table } from "@site/src/components/table/Table";
import {
  initOptionColumns,
  initOptionData,
  changeAvatarOptionColumns,
  changeAvatarOptionData,
} from "@site/src/data/setup";

# SDK 메서드

Klleon Chat SDK는 웹 애플리케이션과의 다양한 상호작용을 위한 메서드들을 제공합니다. SDK 초기화부터 메시지 전송, 아바타 제어까지 주요 기능들을 이 문서에서 안내합니다.

## SDK 라이프사이클

SDK의 생명주기를 올바르게 관리하는 것은 리소스 누수를 방지하고 애플리케이션의 안정성을 확보하는 데 중요합니다.

### `KlleonChat.init(options)`

SDK를 초기화하고 서버와 연결을 준비합니다. 이 메서드는 애플리케이션 로드 시 한 번 호출되어야 합니다.

**초기화 옵션 (`options`):**

<Table columns={initOptionColumns} data={initOptionData} />

:::caution 주의
`KlleonChat.init()`는 SDK 인스턴스당 한 번만 호출하는 것을 권장합니다. SDK는 내부적으로 중복 초기화를 방지하는 로직을 포함하고 있어 여러 번 호출해도 최초 한 번만 정상적으로 초기화됩니다. 다만, 최적의 성능과 명확한 코드 관리를 위해 `init()`은 애플리케이션 로드 시 한 번만 호출하는 것이 좋습니다.
:::

### `KlleonChat.destroy()`

SDK가 사용하던 모든 리소스(소켓 연결, WebRTC 연결, 이벤트 리스너 등)를 정리하고 SDK를 완전히 종료합니다.

**사용 예시 (초기화 및 종료 통합):**

```tsx title="App.tsx (SDK 라이프사이클 관리)"
import { useEffect } from "react";

const App = () => {
  useEffect(() => {
    const init = async () => {
      const { KlleonChat } = window;

      await KlleonChat.init({
        sdk_key: "YOUR_SDK_KEY",
        avatar_id: "YOUR_AVATAR_ID",
        subtitle_code: "ko_kr",
        voice_code: "ko_kr",
        voice_tts_speech_speed: 1.0,
        enable_microphone: true,
        log_level: "debug",
        custom_id: "YOUR_CUSTOM_ID",
        user_key: "YOUR_USER_KEY",
      });
    };

    return () => {
      // KlleonChat SDK의 모든 리소스를 정리하고 종료합니다.
      window.KlleonChat.destroy();
    };
  }, []);
  return (
    <div>
      <avatar-container />
      <chat-container />
    </div>
  );
};

export default App;
```

## 메시지 전송

### `KlleonChat.sendTextMessage(text)`

사용자가 입력한 텍스트 메시지를 아바타에게 전송합니다.

- **text** (string, 필수): 아바타에게 전송할 텍스트 메시지입니다.

**사용 예시:**

```tsx title="App.tsx (sendTextMessage)"
import { useRef } from "react";

const App = () => {
  const inputRef = useRef<HTMLInputElement>(null);

  const handleSend = () => {
    const text = inputRef.current?.value.trim();
    if (text) {
      window.KlleonChat.sendTextMessage(text);
      inputRef.current.value = "";
    }
  };
  return (
    <div>
      <avatar-container />
      <chat-container />
      <input ref={inputRef} type="text" placeholder="메시지 입력" />
      <button onClick={handleSend}>보내기</button>
    </div>
  );
```

## 음성 입력 (STT: Speech-to-Text)

사용자의 음성을 텍스트로 변환하여 아바타에게 전달하는 기능입니다. `startStt()`로 음성 입력을 시작하고, `endStt()`로 입력을 마치고 전송합니다.

:::info 마이크 권한
음성 대화 기능을 사용하려면 브라우저에서 마이크 사용 권한이 필요합니다. `init()` 시 `enable_microphone: true` (기본값)로 설정하면 SDK가 마이크 연결을 시도합니다.
:::

### `KlleonChat.startStt()` / `KlleonChat.endStt()`

- **`KlleonChat.startStt()`**: 마이크를 통해 음성 데이터 수집을 시작합니다.
- **`KlleonChat.endStt()`**: 진행 중인 음성 데이터 수집을 중단하고, 수집된 음성을 텍스트로 변환하여 아바타에게 메시지로 전송합니다.

**사용 예시**

```tsx title="App.tsx (startStt, endStt)"
import { useRef } from "react";

const App = () => {
  const recordButtonRef = useRef<HTMLButtonElement>(null);
  const isRecording = useRef(false);

  const handleRecord = () => {
    if (!isRecording.current) {
      window.KlleonChat.startStt();
      isRecording.current = true;
    }
    if (isRecording.current) {
      window.KlleonChat.endStt();
      isRecording.current = false;
    }
  };

  return (
    <div>
      <avatar-container />
      <button ref={recordButtonRef} onClick={handleRecord}>
        녹음 시작
      </button>
    </div>
  );
};

export default App;
```

## 아바타 발화 제어

### `KlleonChat.cancelStt()`

진행 중인 음성 입력(`startStt()` 호출 후 상태)을 취소합니다. 취소된 음성 데이터는 아바타에게 전송되지 않으며, 다시 음성 입력을 시작할 수 있는 상태가 됩니다. 사용자가 음성 입력 도중 내용을 취소하고 싶을 때 사용합니다.

**사용 예시:**

```tsx title="App.tsx (cancelStt)"
import { useRef } from "react";

const App = () => {
  const recordButtonRef = useRef<HTMLButtonElement>(null);
  const cancelButtonRef = useRef<HTMLButtonElement>(null);
  const isRecording = useRef(false);

  const handleRecord = () => {
    if (!isRecording.current) {
      window.KlleonChat.startStt();
      isRecording.current = true;
    }
    if (isRecording.current) {
      window.KlleonChat.endStt();
      isRecording.current = false;
    }
  };

  const handleCancel = () => {
    window.KlleonChat.cancelStt();
    isRecording.current = false;
  };

  return (
    <div>
      <avatar-container />
      <button ref={recordButtonRef} onClick={handleRecord}>
        녹음 시작
      </button>
      <button ref={cancelButtonRef} onClick={handleCancel}>
        녹음 취소
      </button>
    </div>
  );
};

export default App;
```

### `KlleonChat.stopSpeech()`

현재 아바타가 말하고 있는 음성(TTS) 출력을 즉시 중단시킵니다.

**사용 예시:**

```tsx title="App.tsx (stopSpeech)"
import { useRef } from "react";

const App = () => {
  const recordButtonRef = useRef<HTMLButtonElement>(null);
  const stopSpeechButtonRef = useRef<HTMLButtonElement>(null);
  const isRecording = useRef(false);

  const handleRecord = () => {
    if (!isRecording.current) {
      window.KlleonChat.startStt();
      isRecording.current = true;
    }
    if (isRecording.current) {
      window.KlleonChat.endStt();
      isRecording.current = false;
    }
  };

  const handleStopSpeech = () => {
    window.KlleonChat.stopSpeech();
  };

  return (
    <div>
      <avatar-container />
      <button ref={recordButtonRef} onClick={handleRecord}>
        녹음 시작
      </button>
      <button ref={stopSpeechButtonRef} onClick={handleStopSpeech}>
        음성 중지
      </button>
    </div>
  );
};

export default App;
```

## 에코 기능

### `KlleonChat.echo(text)`

제공된 `text` 문자열을 아바타가 그대로 발화(TTS)하도록 요청합니다.

- **text** (string, 필수): 아바타가 발화할 문자열 메시지입니다.

**사용 예시:**

```tsx title="App.tsx (echo)"
import { useRef } from "react";

const App = () => {
  const inputRef = useRef<HTMLInputElement>(null);

  const handleSend = () => {
    const text = inputRef.current?.value.trim();
    if (text) {
      window.KlleonChat.echo(text);
      inputRef.current.value = "";
    }
  };
  return (
    <div>
      <avatar-container />
      <chat-container />
      <input ref={inputRef} type="text" placeholder="메시지 입력" />
      <button onClick={handleSend}>보내기</button>
    </div>
  );
```

### `KlleonChat.startAudioEcho(audio)` / `KlleonChat.endAudioEcho()`

- **`KlleonChat.startAudioEcho(audio)`**: Base64로 인코딩된 `audio` 문자열 데이터를 서버로 전송하여 오디오 에코 기능을 시작합니다. 이 메서드 호출 후, SDK는 계속해서 오디오를 녹음하는 상태로 간주될 수 있으며, `endAudioEcho()`를 호출하여 명시적으로 종료해야 합니다.
  - `audio` (string, 필수): Base64로 인코딩된 오디오 데이터 문자열. (0.1MB 제한, 유효한 Base64)
- **`KlleonChat.endAudioEcho()`**: 진행 중인 오디오 에코 기능을 종료합니다.

**사용 예시:**

```javascript
const base64AudioInput = document.getElementById("base64-audio-input"); // <textarea id="base64-audio-input"></textarea>
const startAudioEchoButton = document.getElementById("start-audio-echo");
const endAudioEchoButton = document.getElementById("end-audio-echo");

startAudioEchoButton.addEventListener("click", () => {
  const audioData = base64AudioInput.value.trim();
  if (audioData) {
    try {
      window.KlleonChat.startAudioEcho(audioData);
      console.log("오디오 에코 시작됨.");
      // UI 업데이트: 에코 중 상태 표시
    } catch (error) {
      console.error("오디오 에코 시작 실패:", error);
    }
  }
});

endAudioEchoButton.addEventListener("click", () => {
  try {
    window.KlleonChat.endAudioEcho();
    console.log("오디오 에코 종료됨.");
    // UI 업데이트: 에코 중지 상태 표시
  } catch (error) {
    console.error("오디오 에코 종료 실패:", error);
  }
});
```

## 아바타 변경

### `KlleonChat.changeAvatar(option)`

현재 SDK 세션을 종료하고, 지정된 `option`으로 새로운 아바타와 새 세션을 시작합니다.

**ChangeAvatarOption**:

<Table columns={changeAvatarOptionColumns} data={changeAvatarOptionData} />

**사용 예시:**

```tsx title="App.tsx (changeAvatar)"
const App = () => {
  const handleChangeAvatar = () => {
    window.KlleonChat.changeAvatar({
      avatar_id: "YOUR_AVATAR_ID",
      subtitle_code: "en_us",
      voice_code: "en_us",
      voice_tts_speech_speed: 1.0,
    });
  };

  return (
    <div>
      <avatar-container />
      <chat-container />
      <button onClick={handleChangeAvatar}>아바타 변경</button>
    </div>
  );
```

## 메시지 목록 관리

### `KlleonChat.clearMessageList()`

SDK 내부의 메시지 목록 상태를 비웁니다. 주로 `<chat-container>`와 같은 SDK 제공 UI 웹 컴포넌트와 함께 사용할 때, 해당 컴포넌트에 표시된 메시지들을 화면에서 지우는 데 사용됩니다. 이 메서드는 대화의 기억(로그)을 서버에서 삭제하는 것이 아니라, 클라이언트 측 UI 표시용 메시지 배열을 초기화합니다.

**사용 예시:**

```tsx title="App.tsx (clearMessageList)"
const App = () => {
  const handleClearMessageList = () => {
    window.KlleonChat.clearMessageList();
  };

  return (
    <div>
      <avatar-container />
      <chat-container />
      <button onClick={handleClearMessageList}>메시지 목록 초기화</button>
    </div>
  );
```
